# ğŸ”§ GeologAI åº”ç”¨è°ƒè¯•æŒ‡å—

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: `'dict' object has no attribute 'id'`

**åŸå› **: å‰ç«¯ä»£ç å°è¯•è®¿é—®å­—å…¸å¯¹è±¡çš„å±æ€§ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­—å…¸çš„ get() æ–¹æ³•ã€‚

**ç—‡çŠ¶**:
```
AttributeError: 'dict' object has no attribute 'id'
Traceback: project.id æˆ– p.get('id') å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:
âœ… å·²ä¿®å¤ï¼ä¿®å¤å†…å®¹ï¼š
- ä½¿ç”¨ `.get('id')` ä»£æ›¿ç›´æ¥è®¿é—® `.id`
- å…¼å®¹å¤šç§å¯èƒ½çš„ ID å­—æ®µå (`id` æˆ– `project_id`)
- æ·»åŠ å®‰å…¨çš„ç©ºå€¼æ£€æŸ¥

**éªŒè¯ä¿®å¤**:
```bash
# è¿è¡Œ app.pyï¼Œåˆ›å»ºæ–°é¡¹ç›®
# è§‚å¯Ÿæ˜¯å¦ä»ç„¶æŠ¥é”™
```

---

### é”™è¯¯2: `API è¿”å›æ ¼å¼ä¸ç¬¦`

**åŸå› **: åç«¯ API è¿”å›çš„æ•°æ®ç»“æ„ä¸å‰ç«¯é¢„æœŸä¸ç¬¦ã€‚

**ç¤ºä¾‹**:
- åç«¯è¿”å›: `{"data": [...], "total": 10, ...}`
- å‰ç«¯æœŸæœ›: ç›´æ¥çš„åˆ—è¡¨ `[...]`

**è§£å†³æ–¹æ¡ˆ**:
âœ… å·²ä¿®å¤ï¼å‰ç«¯ä»£ç ç°å·²å¤„ç†ï¼š
```python
def get_projects():
    response = requests.get(...)
    data = response.json()
    
    # å¤„ç†ä¸¤ç§æ ¼å¼
    if isinstance(data, dict) and "data" in data:
        return data.get("data", [])  # æ–°æ ¼å¼
    return data if isinstance(data, list) else []  # æ—§æ ¼å¼
```

---

### é”™è¯¯3: `æ— æ³•è¿æ¥åˆ°åç«¯`

**ç—‡çŠ¶**:
```
âŒ é”™è¯¯: [Errno 10048] error while attempting to bind on address ('127.0.0.1', 8001)
```

**åŸå› **: ç«¯å£è¢«å ç”¨æˆ–åç«¯æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr ":8001"

# 2. æ€æ­»å ç”¨è¿›ç¨‹
taskkill /PID <PID> /F

# 3. é‡å¯åç«¯
cd D:\GeologAI\backend
conda activate geologai
python run_backend.py
```

---

### é”™è¯¯4: `ç™»å½•å¤±è´¥`

**ç—‡çŠ¶**:
```
âŒ ç™»å½•å¤±è´¥: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
```

**åŸå› **: ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. ç¡®è®¤ç”¨æˆ·å­˜åœ¨ï¼ˆè¿è¡Œ test_api_integration.pyï¼‰
python test_api_integration.py

# 2. æ£€æŸ¥åç«¯æ—¥å¿—
# æŸ¥çœ‹ run_backend.py çš„è¾“å‡ºä¿¡æ¯

# 3. å°è¯•é‡æ–°æ³¨å†Œ
# ä½¿ç”¨å‰ç«¯åº”ç”¨çš„æ³¨å†ŒåŠŸèƒ½
```

---

### é”™è¯¯5: `æ•°æ®ä¸Šä¼ å¤±è´¥`

**ç—‡çŠ¶**:
```
âŒ ä¸Šä¼ å¤±è´¥: [å…·ä½“é”™è¯¯ä¿¡æ¯]
```

**åŸå› **: 
- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- é¡¹ç›®ä¸å­˜åœ¨
- æœåŠ¡å™¨ç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®
# æ”¯æŒ: .las, .csv, .xlsx, .xls

# 2. æ£€æŸ¥é¡¹ç›®æ˜¯å¦å­˜åœ¨
# åœ¨é¡¹ç›®ç®¡ç†é¡µé¢ç¡®è®¤é¡¹ç›®å·²åˆ›å»º

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
# ç¡®ä¿ backend ç›®å½•æ‰€åœ¨ç£ç›˜æœ‰è¶³å¤Ÿç©ºé—´
```

---

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### è¿è¡Œ API é›†æˆæµ‹è¯•

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate geologai

# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_api_integration.py
```

**é¢„æœŸè¾“å‡º**:
```
============================================================
ğŸŒ GeologAI API æµ‹è¯•
============================================================

============================================================
ğŸ§ª ç”¨æˆ·ç™»å½•
============================================================
æ–¹æ³•: POST
URL: http://127.0.0.1:8001/api/v1/auth/login
çŠ¶æ€ç : 200
å“åº”: {
  "access_token": "...",
  "token_type": "bearer",
  ...
}

âœ… ç™»å½•æˆåŠŸï¼Token: ...
```

### å‰ç«¯åº”ç”¨è°ƒè¯•

1. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·** (F12)
   - æŸ¥çœ‹ Console æ ‡ç­¾é¡µ
   - ç›‘æ§ Network æ ‡ç­¾é¡µçš„ API è¯·æ±‚

2. **æŸ¥çœ‹ Streamlit æ—¥å¿—**
   - ç»ˆç«¯è¾“å‡ºä¼šæ˜¾ç¤ºæ‰€æœ‰è¯·æ±‚å’Œé”™è¯¯
   - å¯»æ‰¾çº¢è‰²çš„é”™è¯¯ä¿¡æ¯

3. **æ·»åŠ è°ƒè¯•è¾“å‡º**
   ```python
   # åœ¨ app.py ä¸­æ·»åŠ 
   st.write(f"DEBUG: projects = {projects}")  # æ‰“å°è°ƒè¯•ä¿¡æ¯
   ```

---

## âœ… éªŒè¯æ­¥éª¤

### æ­¥éª¤1: åç«¯è¿è¡Œæ­£å¸¸
```bash
# åç«¯å¯åŠ¨æ—¶åº”æ˜¾ç¤º:
ğŸš€ Starting GeologAI Backend on http://127.0.0.1:8001
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
âœ… APIè·¯ç”±å·²æ³¨å†Œ
INFO:     Uvicorn running on http://127.0.0.1:8001
```

### æ­¥éª¤2: å‰ç«¯è¿è¡Œæ­£å¸¸
```bash
# è®¿é—® http://localhost:8501
# åº”æ˜¾ç¤ºç™»å½•ç•Œé¢
# å¯ä»¥æˆåŠŸç™»å½•å’Œåˆ›å»ºé¡¹ç›®
```

### æ­¥éª¤3: API å“åº”æ ¼å¼æ£€æŸ¥
```bash
# åœ¨æµè§ˆå™¨æˆ– curl ä¸­æµ‹è¯•
curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://127.0.0.1:8001/api/v1/projects/my-projects

# åº”è¿”å›:
{
  "data": [
    {"id": 1, "name": "é¡¹ç›®1", ...},
    {"id": 2, "name": "é¡¹ç›®2", ...}
  ],
  "total": 2,
  "skip": 0,
  "limit": 10
}
```

---

## ğŸ“ è°ƒè¯•æŠ€å·§

### 1. ä½¿ç”¨æ—¥å¿—è¿½è¸ª

```python
# åœ¨ app.py ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
import logging

logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

logger.debug(f"é¡¹ç›®åˆ—è¡¨: {projects}")
logger.error(f"é”™è¯¯ä¿¡æ¯: {error_message}")
```

### 2. éªŒè¯ API å“åº”

```python
# æ·»åŠ å“åº”éªŒè¯
response = requests.get(url, headers=headers)
st.write(f"çŠ¶æ€ç : {response.status_code}")
st.write(f"åŸå§‹å“åº”: {response.text[:500]}")  # æ˜¾ç¤ºå‰500ä¸ªå­—ç¬¦
st.write(f"è§£æå: {response.json()}")
```

### 3. å•æ­¥è°ƒè¯•

```bash
# ä½¿ç”¨ Python è°ƒè¯•å™¨
python -m pdb D:\GeologAI\web\frontend\app.py

# åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹
breakpoint()  # Python 3.7+
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å‡å°‘ API è°ƒç”¨
```python
# ä¸è¦åœ¨å¾ªç¯ä¸­é‡å¤è°ƒç”¨ API
# âŒ é”™è¯¯
for p in projects:
    data = get_project_data(p['id'])  # æ¯æ¬¡å¾ªç¯éƒ½è°ƒç”¨

# âœ… æ­£ç¡®
project_data_cache = {}
for p in projects:
    if p['id'] not in project_data_cache:
        project_data_cache[p['id']] = get_project_data(p['id'])
```

### ä½¿ç”¨ç¼“å­˜
```python
# Streamlit ç¼“å­˜è£…é¥°å™¨
@st.cache_data(ttl=300)  # 5åˆ†é’Ÿç¼“å­˜
def get_projects():
    return requests.get(...).json()
```

---

## ğŸ“ è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥ç»ˆç«¯è¾“å‡ºå’Œæµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. **è¿è¡Œæµ‹è¯•**: æ‰§è¡Œ `test_api_integration.py`
3. **æŸ¥çœ‹æ–‡æ¡£**: å‚è€ƒ `INTEGRATED_APP_QUICKSTART.md`
4. **æ£€æŸ¥API**: è®¿é—® http://localhost:8001/docs (Swaggeræ–‡æ¡£)

---

**æœ€åæ›´æ–°**: 2025-11-20
